# Nombre del workflow que verás en la pestaña "Actions" de GitHub
name: CI - Build and Test

# Trigger: Cuándo se debe ejecutar este workflow
on:
  # Ejecútalo en CADA push a la rama 'main'
  push:
    branches: [main]
  # Ejecútalo en CADA Pull Request que apunte a 'main'
  pull_request:
    branches: [main]

# Define los trabajos (jobs) que se van a ejecutar
jobs:
  build-and-test:
    # El tipo de máquina virtual que usaremos
    runs-on: ubuntu-latest

    # Los pasos que debe seguir
    steps:
      # 1. Descarga tu código
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2. Configura el entorno de Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20 # O la versión de Node que estés usando
          cache: "npm" # Habilita el caché para instalaciones más rápidas

      # 3. Instala las dependencias (usa 'ci' para builds consistentes)
      - name: Install Dependencies
        run: npm ci

      # 4. Ejecuta el Linter
      # Este paso usa tu script: "npm run lint"
      - name: Run Linter
        run: npm run lint

      # 5. Ejecuta las Pruebas
      # Este paso usa tu script: "npm run test"
      # (Jest corre automáticamente en modo no-watch en CI)
      - name: Run Tests
        run: npm run test

      # 6. Ejecuta el Build de Producción
      # Este paso usa tu script: "npm run build"
      # Es vital para detectar errores de TypeScript o de compilación
      - name: Run Production Build
        run: npm run build
